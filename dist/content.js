(()=>{"use strict";class e{constructor(){this.authToken=null}static getInstance(){return e.instance||(e.instance=new e),e.instance}setAuthToken(e){this.authToken=e}getAuthToken(){return this.authToken}clearAuthToken(){this.authToken=null}async makeRequest(e,t={}){const n=`http://127.0.0.1:8000/api${e}`,s={"Content-Type":"application/json"};this.authToken&&(s.Authorization=`Token ${this.authToken.token}`);try{const e=await fetch(n,{...t,headers:{...s,...t.headers}}),r=await e.json();return e.ok?{success:!0,data:r}:{success:!1,error:r.error||r.message||`HTTP ${e.status}`}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Network error"}}}async login(e,t){const n=await this.makeRequest("/users/login/",{method:"POST",body:JSON.stringify({username:e,password:t})});return n.success&&n.data?{success:!0,data:{token:{token:n.data.token,expiresAt:Date.now()+864e5,userId:n.data.user_id.toString()},user:{id:n.data.user_id.toString(),email:"",name:n.data.username}}}:n}async signup(e,t,n,s){const r=await this.makeRequest("/users/register/",{method:"POST",body:JSON.stringify({username:e,email:t,password:n,first_name:s.split(" ")[0]||s,last_name:s.split(" ").slice(1).join(" ")||""})});return r.success&&r.data?{success:!0,data:{token:{token:r.data.token,expiresAt:Date.now()+864e5,userId:r.data.user_id.toString()},user:{id:r.data.user_id.toString(),email:t,name:r.data.username}}}:r}async logout(){return this.makeRequest("/users/logout/",{method:"POST"})}async getPlayerDataByName(e){return this.makeRequest(`/players/data/${encodeURIComponent(e)}/`)}async getCurrentUser(){const e=await this.makeRequest("/users/validate-token/");return e.success&&e.data?{success:!0,data:{id:e.data.user_id.toString(),email:"",name:e.data.username}}:e}}const t="auth_token",n="user_data";class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}async get(e){try{return(await chrome.storage.local.get(e))[e]||null}catch(e){return console.error("Error getting from storage:",e),null}}async set(e,t){try{await chrome.storage.local.set({[e]:t})}catch(e){console.error("Error setting storage:",e)}}async remove(e){try{await chrome.storage.local.remove(e)}catch(e){console.error("Error removing from storage:",e)}}async clear(){try{await chrome.storage.local.clear()}catch(e){console.error("Error clearing storage:",e)}}async getAuthToken(){const e=await this.get(t);return e?Date.now()>e.expiresAt?(await this.clearAuthToken(),null):e:null}async setAuthToken(e){await this.set(t,e)}async clearAuthToken(){await this.remove(t)}async getUserData(){return this.get(n)}async setUserData(e){await this.set(n,e)}async clearUserData(){await this.remove(n)}}class r{constructor(){this.observer=null,this.isInitialized=!1,this.apiService=e.getInstance(),this.storageService=s.getInstance()}async init(){this.isInitialized||(await this.initializeAuth(),this.setupObserver(),this.setupScrollListener(),this.addButtonsToAllRows(),this.isInitialized=!0)}async initializeAuth(){const e=await this.storageService.getAuthToken();e&&this.apiService.setAuthToken(e)}setupObserver(){this.observer=new MutationObserver(()=>{this.addButtonsToAllRows()}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]})}setupScrollListener(){document.addEventListener("scroll",()=>{this.addButtonsToAllRows()},{passive:!0}),document.addEventListener("scroll",e=>{e.target!==document&&this.addButtonsToAllRows()},{passive:!0,capture:!0})}addButtonsToAllRows(){const e=document.querySelector(".draft-players");e&&e.querySelectorAll(".playerinfo__playername").forEach((e,t)=>{e.closest(".player-details")?.querySelector(".drafty-action-btn")||this.addButtonToElement(e,t)})}addButtonToElement(e,t){const n=document.createElement("button");n.className="drafty-action-btn",n.textContent="ðŸ“Š",n.title="Get player insights",n.style.cssText="\n      background: #007bff;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      padding: 2px 6px;\n      font-size: 12px;\n      cursor: pointer;\n      margin-left: 8px;\n      transition: background-color 0.2s;\n      display: inline-block;\n      vertical-align: middle;\n    ",n.addEventListener("mouseenter",()=>{n.style.background="#0056b3"}),n.addEventListener("mouseleave",()=>{n.style.background="#007bff"}),n.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.handleElementClick(e)});const s=e.closest(".flex");if(s&&!s.querySelector(".drafty-action-btn"))s.appendChild(n);else{const t=e.parentElement;t&&!t.querySelector(".drafty-action-btn")&&t.insertBefore(n,e.nextSibling)}}async handleElementClick(e){const t=this.extractPlayerNameFromElement(e);if(t)try{if(!await this.storageService.getAuthToken())return void this.showError("Please log in to get player insights");const n=await this.apiService.getPlayerDataByName(t);n.success&&n.data?this.showPlayerData(e,t,n.data):this.showError(`Failed to get data for ${t}: ${n.error}`)}catch(e){console.error("Error handling player action:",e),this.showError("An error occurred while fetching player data")}else this.showError("Could not find player name")}extractPlayerNameFromElement(e){const t=e.cloneNode(!0);return t.querySelectorAll(".drafty-action-btn").forEach(e=>e.remove()),t.textContent?.trim()||""}showPlayerData(e,t,n){const s=document.querySelector(".drafty-popup");s&&s.remove();const r=document.createElement("div");r.className="drafty-popup",r.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      border: 1px solid #ccc;\n      border-radius: 8px;\n      padding: 20px;\n      z-index: 10001;\n      font-family: Arial, sans-serif;\n      font-size: 14px;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n      max-width: 400px;\n      max-height: 80vh;\n      overflow-y: auto;\n    ";const a=document.createElement("h3");a.textContent=`${t} - Player Insights`,a.style.cssText="\n      margin: 0 0 15px 0;\n      color: #333;\n      font-size: 18px;\n      border-bottom: 2px solid #007bff;\n      padding-bottom: 8px;\n    ";const o=document.createElement("div");if(n.rank){const e=document.createElement("div");e.style.cssText="margin-bottom: 10px;",e.innerHTML=`<strong>Rank:</strong> ${n.rank}`,o.appendChild(e)}const i=n.insights||[];if(i.length>0){const e=document.createElement("div");e.style.cssText="margin-bottom: 10px;",e.innerHTML="<strong>Insights:</strong>";const t=document.createElement("ul");t.style.cssText="margin: 5px 0 0 20px; padding: 0;",i.forEach(e=>{const n=document.createElement("li");n.textContent=e.message||e,n.style.cssText="margin-bottom: 5px;",t.appendChild(n)}),e.appendChild(t),o.appendChild(e)}if(n.additionalData){const e=document.createElement("div");e.style.cssText="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;",e.innerHTML=`<strong>Additional Data:</strong><br>${JSON.stringify(n.additionalData,null,2)}`,o.appendChild(e)}const c=document.createElement("button");c.textContent="Close",c.style.cssText="\n      background: #6c757d;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      padding: 8px 16px;\n      cursor: pointer;\n      margin-top: 15px;\n      font-size: 14px;\n    ",c.addEventListener("click",()=>{r.remove()}),r.addEventListener("click",e=>{e.target===r&&r.remove()});const d=e=>{"Escape"===e.key&&(r.remove(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d),r.appendChild(a),r.appendChild(o),r.appendChild(c);const l=document.createElement("div");l.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.5);\n      z-index: 10000;\n    ",l.addEventListener("click",()=>{l.remove(),r.remove(),document.removeEventListener("keydown",d)}),document.body.appendChild(l),document.body.appendChild(r)}showError(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #dc3545;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 4px;\n      z-index: 10000;\n      font-family: Arial, sans-serif;\n      font-size: 14px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null);const e=document.querySelector(".drafty-popup");e&&e.remove();const t=document.querySelector('div[style*="rgba(0,0,0,0.5)"]');t&&t.remove(),this.isInitialized=!1}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new r).init()}):(new r).init()})();